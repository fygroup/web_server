(function($,window){var _methods={required:function(value,element){switch(element[0].nodeName.toLowerCase()){case"select":return value&&value.length>0;default:return $.trim(value).length>0}},maxLength:function(value,element,param){var length=eval("("+param+")").length;return value.length<=length},email:function(value){return/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))$/i.test(value)},remote:function(value,element,param){param=eval("("+param+")");var result=false,eleName=element.attr("name"),reqUrl=param.reqUrl,reqData=param.reqData,reqParams=param.reqParams?param.reqParams:{};$.ajax({async:false,type:"POST",url:reqUrl,data:$.extend({},eval("("+("{"+eleName+":'"+value+"'}")+")"),reqParams),dataType:"json",success:function(data){if(reqData){result=data[param.reqData]===true}else{result=data===true}}});return result},password:function(value,element,param){var passwordId=element.attr("id").substr(1);if($("#"+passwordId).val()!=value){return false}else{return true}},checkBoxRequired:function(value,element,param){var arr=$(":checkbox[checked=true]",element);if(arr.length>0){return true}else{return false}},ip:function(value,element){return/^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/.test(value)},url:function(value,element){return/^(https?|ftp):\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(\#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i.test(value)},date:function(value,element){return/^(?:(?!0000)[0-9]{4}-(?:(?:0[1-9]|1[0-2])-(?:0[1-9]|1[0-9]|2[0-8])|(?:0[13-9]|1[0-2])-(?:29|30)|(?:0[13578]|1[02])-31)|(?:[0-9]{2}(?:0[48]|[2468][048]|[13579][26])|(?:0[48]|[2468][048]|[13579][26])00)-02-29)$/.test(value)},noSpecialCaracters:function(value,element){return/^[_0-9a-zA-Z\u4e00-\u9fa5]+$/.test(value)},size:function(value,element,param){param=eval("("+param+")");var size=param&&param.size||{};var min=this.number(size[0])?parseInt(size[0]):0,max=this.number(size[1])?parseInt(size[1]):Number.MAX_VALUE;var length=value.length;return length>=min&&length<=max},range:function(value,element,param){var range,min,max;if(this.number(value)){param=eval("("+param+")");range=param&&param.range||{};min=this.number(range[0])?Number(range[0]):-Number.MAX_VALUE;max=this.number(range[1])?Number(range[1]):Number.MAX_VALUE;value=Number(value);return value>=min&&value<=max}return false},number:function(value){return/^-?\d*\.?\d+$/.test(value)},integer:function(value){return/^-?\d+$/.test(value)}};var _messages={required:"必须填写此内容.",maxLength:"长度超出限制.",remote:"Please fix this field.",email:"请输入有效的电子邮件地址.",password:"输入的密码不一致.",checkBoxRequired:"请至少选择一项.",ip:"错误的IP地址.",url:"错误的超链接.",date:"无效的日期.",noSpecialCaracters:"只能输入数字、英文字母、汉字与下划线.",size:"长度必须在${size[0]}与${size[1]}之间.",range:"必须为数字, 且值必须在${range[0]}与${range[1]}之间.",number:"必须为数字.",integer:"必须为整数"},defaults={color:undefined,fontStyle:undefined,fontWeight:undefined,fontSize:undefined,fontFamily:undefined,lineHeight:undefined,showAlways:true,tooltipFadeInSpeed:0,tooltipFadeOutSpeed:0,tooltipMoveSpeed:500,tooltipMoveAnimate:undefined,eventName:".validatebox",container:"body",arrowPointing:null},_posfixtips={};
$.jvalidate={adaptive:function(){var key=null,value=null;for(key in _posfixtips){value=_posfixtips[key];if(value){if(value.tooltip.is(".dn")){value.tooltip.css("top",value.validEle.position().top-value.tooltip.outerHeight()+1)}else{if(value.tooltip.is(".up")){value.tooltip.css("top",value.validEle.position().top+value.validEle.outerHeight()-1)}}}}},addMethod:function(validType,fun,msg){_methods[validType]=fun;_messages[validType]=msg},existMethod:function(validType){return !!_methods[validType]}},$.fn.jvalidate=function(opts){var _identifiers=new Object();var options=$.extend({},defaults,opts||{});var validArr={};var _this=this;var validEles=_this.find(".jvalidate");function check(validEle){var validTypeStr=validEle.attr("validtype");if(!validTypeStr){validTypeStr="required"}var validTypes=validTypeStr.split(",");$.each(validTypes,function(i,validType){var validPar=validEle.attr("validpar");var validFun=_methods[validType];if(!validType){validType="required"}if(!validFun){validFun=_methods["required"]}var result=validFun.call(_methods,validEle.val(),validEle,validPar);var vid=validEle.data("validate-identifier");if(!vid){vid=generateIdentifier();validEle.data("validate-identifier",vid)}var tooltipId=vid+"_validatebox-tip";if(!result){if(validEle.data("jvalidate-type")&&(validType!=validEle.data("jvalidate-type"))){correct(vid,tooltipId)}if(!validEle.data("jvalidate")){validEle.data("jvalidate",true);validEle.data("jvalidate-type",validType);validArr[vid]=false;validEle.addClass("validatebox-invalid");var msg=_messages[validType];if(validEle.attr(validType+"msg")){msg=validEle.attr(validType+"msg")}var startIdx,endIdx,variable,qPrefix="${",qSuffix="}",varVal;while(((startIdx=msg.indexOf(qPrefix))!=-1)&&((endIdx=msg.indexOf(qSuffix,startIdx))!=-1)){variable=msg.substring(startIdx+qPrefix.length,endIdx);try{varVal=eval("( "+validPar+"."+variable+")")}catch(e){varVal=undefined}msg=msg.substring(0,startIdx)+varVal+msg.substring(endIdx+qSuffix.length)}var $tooltip=$('<div id="'+tooltipId+'" class="validatebox-tip">'+'<div class="validatebox-tip-tr"><div class="validatebox-tip-tl">'+'<div class="fill-height"></div></div></div><div class="validatebox-tip-cr">'+'<div class="validatebox-tip-cl">'+msg+'</div></div><div class="validatebox-tip-br">'+'<div class="validatebox-tip-bl"><div class="fill-height"></div></div></div></div>');$tooltip.insertAfter(validEle).css({color:options.color,fontStyle:options.fontStyle,fontWeight:options.fontWeight,fontSize:options.fontSize,fontFamily:options.fontFamily,lineHeight:options.lineHeight});if(options.showAlways){displayTooltip(validEle,$tooltip)}else{validEle.bind("mouseover"+options.eventName,function(){displayTooltip(validEle,$tooltip)}).bind("mouseout"+options.eventName,function(){$tooltip.fadeOut(options.tooltipFadeOutSpeed)})}}else{if($("#"+tooltipId).is(":hidden")&&options.showAlways){displayTooltip(validEle,$("#"+tooltipId))}}}else{if(i+1===validTypes.length){correct(vid,tooltipId)}}return result});function correct(vid,tooltipId){reset(validEle);validArr[vid]=true}}function reset(validEle){if(!validEle){return}var vid=validEle.data("validate-identifier");if(vid){var tooltipId=vid+"_validatebox-tip";validEle.data("jvalidate",false);validEle.removeData("jvalidate-type");validEle.removeClass("validatebox-invalid");validEle.unbind("mouseover"+options.eventName+" "+"mouseout"+options.eventName);delete _posfixtips[tooltipId];$("#"+tooltipId).remove()}}function displayTooltip(validEle,$tooltip){if(parseInt($tooltip.css("left"))!=0){$tooltip.fadeIn(options.tooltipFadeInSpeed)}else{var bw=$(options.container).width()-10;var pos=validEle.position();pos.left-=10;var src={left:pos.left,top:pos.top+1},dst={left:pos.left+validEle.outerWidth()-39,top:pos.top+1};$tooltip.show();var tipWidth=$tooltip.outerWidth();$tooltip.width(tipWidth);$tooltip.css(dst).removeClass("up").addClass("dn");var tipHeight=$tooltip.outerHeight();src.top-=tipHeight,dst.top-=tipHeight;if($tooltip.offset().left+tipWidth>bw){dst.left=dst.left-($tooltip.offset().left+tipWidth-bw);var minDistance=30;if(dst.left<src.left+minDistance){dst.left=src.left;src.left=dst.left+minDistance}}var arrowPointing=false;if(options.arrowPointing){for(var expr in options.arrowPointing){if(validEle.is(expr)){arrowPointing=options.arrowPointing[expr];break}}}if(arrowPointing!="dn"){if(tipHeight>validEle.offset().top||arrowPointing==="up"){src.top=dst.top=pos.top+validEle.outerHeight()-1;$tooltip.removeClass("dn").addClass("up")}}if(options.showAlways){_posfixtips[$tooltip.attr("id")]={tooltip:$tooltip,validEle:validEle}}$tooltip.show().css(src).animate(dst,options.tooltipMoveSpeed,options.tooltipMoveAnimate)}}function checkAll(){validEles.each(function(){check($(this))})}function resetAll(){validEles.each(function(){reset($(this))})}function generateIdentifier(){var id=new Date().getTime();while(_identifiers[id]){id++}_identifiers[id]=true;return id}validEles.bind("focusout",function(){var validEle=$(this);check(validEle)});return $.extend(_this,{valid:function(){checkAll();
for(var i in validArr){if(validArr[i]==false){return false}}return true},reset:function(){resetAll()}})}})(jQuery,window);